{{ define "main" }}
  {{- $notes := where site.RegularPages "Section" "notes" -}}
  {{- $notes = sort $notes "Lastmod" "desc" -}}
  {{- $paginator := .Paginate $notes -}}

  {{- if eq $paginator.PageNumber 1 -}}
    <section class="intro" data-pagefind-ignore>
      <h1 class="intro-title">{{ site.Params.introTitle | default "Welcome to my digital garden." }}</h1>
      <p class="intro-text">
        {{ site.Params.introText | default "I write about computers, my wood working adventures and anything that captures my fascination enough to obsess over for a time." }}
      </p>
    </section>
  {{- end -}}

  <section class="notes-list" data-pagefind-ignore>
    <h2 class="section-title">Notes</h2>

    {{- if not (len $notes) -}}
      <p class="muted">No notes yet.</p>
    {{- else -}}
      <ol class="notes">
        {{- range $paginator.Pages -}}
          <li class="note-item">
            <a class="note-link" href="{{ .RelPermalink }}">
              <span class="note-title">{{ .Title }}</span>
              <div class="note-meta">
                <time class="note-date" datetime="{{ .Lastmod.Format "2006-01-02" }}">{{ .Lastmod.Format "Jan 2, 2006" }}</time>
                {{- with .Params.tags -}}
                  <span>·</span>
                  {{- range . -}}
                    <span class="tag-pill">#{{ . }}</span>
                  {{- end -}}
                {{- end -}}
              </div>
              {{- $excerpt := .Summary | plainify | htmlUnescape | truncate 140 -}}
              {{- if $excerpt -}}
                <p class="note-excerpt">{{ $excerpt }}</p>
              {{- end -}}
            </a>
          </li>
        {{- end -}}
      </ol>

      {{- if gt $paginator.TotalPages 1 -}}
        <nav class="pagination" aria-label="Notes pagination">
          {{- $current := $paginator.PageNumber -}}
          {{- $total := $paginator.TotalPages -}}
          {{- $window := 2 -}}
          {{- $start := sub $current $window -}}
          {{- if lt $start 1 }}{{- $start = 1 -}}{{- end -}}
          {{- $end := add $current $window -}}
          {{- if gt $end $total }}{{- $end = $total -}}{{- end -}}

          <ol class="pagination-list">
            {{- if $paginator.HasPrev -}}
              <li><a class="pagination-link" href="{{ $paginator.First.URL }}" aria-label="First page">«</a></li>
              <li><a class="pagination-link" href="{{ $paginator.Prev.URL }}" aria-label="Previous page">‹</a></li>
            {{- else -}}
              <li><span class="pagination-disabled" aria-hidden="true">«</span></li>
              <li><span class="pagination-disabled" aria-hidden="true">‹</span></li>
            {{- end -}}

            {{- if gt $start 1 -}}
              <li><a class="pagination-link" href="{{ $paginator.First.URL }}">1</a></li>
              {{- if gt $start 2 -}}
                <li><span class="pagination-ellipsis" aria-hidden="true">…</span></li>
              {{- end -}}
            {{- end -}}

            {{- range $paginator.Pagers -}}
              {{- $n := .PageNumber -}}
              {{- if and (ge $n $start) (le $n $end) -}}
                {{- if eq $n $current -}}
                  <li><span class="pagination-current" aria-current="page">{{ $n }}</span></li>
                {{- else -}}
                  <li><a class="pagination-link" href="{{ .URL }}">{{ $n }}</a></li>
                {{- end -}}
              {{- end -}}
            {{- end -}}

            {{- if lt $end $total -}}
              {{- if lt $end (sub $total 1) -}}
                <li><span class="pagination-ellipsis" aria-hidden="true">…</span></li>
              {{- end -}}
              <li><a class="pagination-link" href="{{ $paginator.Last.URL }}">{{ $total }}</a></li>
            {{- end -}}

            {{- if $paginator.HasNext -}}
              <li><a class="pagination-link" href="{{ $paginator.Next.URL }}" aria-label="Next page">›</a></li>
              <li><a class="pagination-link" href="{{ $paginator.Last.URL }}" aria-label="Last page">»</a></li>
            {{- else -}}
              <li><span class="pagination-disabled" aria-hidden="true">›</span></li>
              <li><span class="pagination-disabled" aria-hidden="true">»</span></li>
            {{- end -}}
          </ol>
        </nav>
      {{- end -}}
    {{- end -}}
  </section>
{{ end }}
